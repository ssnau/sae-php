
$(function(){var xtmpl={view_hd:(new Xtemplate('view-hd-template')).getText(),view_description:(new Xtemplate('view-description-template')).getText(),view_substitute:(new Xtemplate('view-substitute-template')).getText(),view_sentence:(new Xtemplate('view-sentence-template')).getText(),view_content:(new Xtemplate('view-content-template')).getText(),view_philosophy:(new Xtemplate('view-philosophy-template')).getText(),view_example:(new Xtemplate('view-example-template')).getText(),view_comments:(new Xtemplate('view-comments-template')).getText(),view_history:(new Xtemplate('view-history-template')).getText(),edit_hd:(new Xtemplate('edit-hd-template')).getText(),edit_description:(new Xtemplate('edit-description-template')).getText(),edit_substitute:(new Xtemplate('edit-substitute-template')).getText(),edit_sentence:(new Xtemplate('edit-sentence-template')).getText(),edit_content:(new Xtemplate('edit-content-template')).getText(),edit_philosophy:(new Xtemplate('edit-philosophy-template')).getText(),edit_example:(new Xtemplate('edit-example-template')).getText(),edit_comments:(new Xtemplate('edit-comments-template')).getText(),edit_history:(new Xtemplate('edit-history-template')).getText(),edit_submit:(new Xtemplate('edit-submit-template')).getText()}
var ndView=$(".w-tabstage.stage .page.view");var ndEdit=$(".w-tabstage.stage .page.edit");var ndForm=ndEdit.parent('form');ndForm.submit(function(e){e.preventDefault();var args=Array.prototype.splice.apply(arguments,[1]);var success_callback=args[0]?args[0]:$.nilfunc;var fail_callback=args[1]?args[1]:$.nilfunc;var action=ndForm.attr('action');var formset=ndForm.serialize();!/&$/.test(action)&&(action+='&');$.receiveJSON(action+formset,function(res){if(res.status){success_callback();alert(res.data);}else{fail_callback();alert(res.msg);}});});ndForm.bind('reset',function(e){var isSure=window.confirm('真的要删除这个条目吗?');if(!isSure){return false;}
var orig_action=ndForm.attr('action');ndForm.attr('action',orig_action.replace('/update','/delete'));ndForm.trigger('submit',[function(){ndView.html('');ndEdit.html('');}]);ndForm.attr('action',orig_action);});var typeArray={'feel':['hd','description','comments','history','submit'],'action':['hd','substitute','comments','history','submit'],'adjective':['hd','substitute','sentence','comments','history','submit'],'philosophy':['hd','philosophy','comments','history','submit'],'template':['hd','content','example','comments','history','submit'],'creative':['hd','content','comments','history','submit'],'tactics':['hd','content','comments','history','submit']};function getTmplsText(nameArray,prefix){var res=[];res=$.map(nameArray,function(elem){return xtmpl[prefix+'_'+elem]?xtmpl[prefix+'_'+elem]:'';});return res.join('\n');}
$.each(typeArray,function(type,val){new Tablelist('#'+type+'-table-list',{'fnClickItem':function(info){ndForm.attr('action','/content/entity/update?type='+type+'&id='+info);var id=info;var tView=new Xtemplate();var tEdit=new Xtemplate();tView.setText(getTmplsText(val,'view'));tEdit.setText(getTmplsText(val,'edit'));$.receiveJSON('/content/getentity',{'type':type,'id':id},function(res){if(res.status){tView.setVar(res.data);tEdit.setVar(res.data);ndView.html(tView.getText());ndEdit.html(tEdit.getText());}else{alert(res.msg);}});}});});var tabstage=new Tabstage('.w-tabstage.stage',{});var tAdd=new Xtemplate();$('.w-tablelist').click(function(e){if(/button|BUTTON/.test(e.target.tagName)){var id=this.id;var type=id.substr(0,id.indexOf('-'));var nameArray=$.grep(typeArray[type],function(val){return val==='history'?false:true;});var add_xtmpl=getTmplsText(nameArray,'edit');tAdd.setText(add_xtmpl);tAdd.fill('');var ndWindow=new ResizedWindow({operation:'add',content:tAdd.getText(),title:type,width:600,height:400});ndWindow.fadeIn(300);var window_id=ndWindow.attr('id');var ndForm=$('#'+window_id+' form');ndForm.bind('submit',function(e){e.preventDefault();e.stopPropagation();var action=ndForm.attr('action')+'?type='+type+'&';var formset=ndForm.serialize();$.receiveJSON(action+formset,function(res){if(res.status){alert(res.data);ndWindow.close();}else{alert(res.msg);}});});}});});