
Tablelist=function(id,cfg){id=/^#/.test(id)?id:'#'+id;var prevId=id+" ";var ndTablelist=$(id);if(!ndTablelist.length)return false;var ndTable=$(prevId+'.table');var ndMenu=$(prevId+'.menu');var ndMenuTitle=$(prevId+'.menu .title');var ndListItems=$(prevId+'li.item');var ndInputSearch=$(prevId+'input');cfg=!!cfg?cfg:{};var config=$.extend({menuBackgroundColor:ndMenu.css('background-color'),fnClickItem:null},cfg);this['instances'].push(this);this['release']=function(){ndMenu.css('background-color',config['menuBackgroundColor']);ndTable.fadeOut(300);}
var _this=this;ndMenu.click(function(e){e.stopPropagation();e.preventDefault();_this.releaseAll();if(!/none/.test(ndTable.css('display'))){return;}
var offset=ndMenu.offset();ndMenu.css('background-color','#aae');ndTable.fadeIn(300);ndTable.css('top',offset['top']+30);ndTable.css('left',offset['left']);});$.addDocumentClick({'name':'hide-'+id+'-table','fn':function(){_this['release']();}});ndTable.click(function(e){e.preventDefault();var ndTarget=$(e.target);var id=null;if(ndTarget.hasClass('item')){!!config.fnClickItem&&config.fnClickItem(ndTarget.attr('data-info'));_this['release']();ndMenuTitle.html(ndTarget.text());}});!!ndInputSearch&&ndInputSearch.keyup(function(e){var text=ndInputSearch.val();text=$.trim(text);text.length?ndListItems.hide():ndListItems.show();$.each(ndListItems,function(index,elem){var searchText=elem.getAttribute('data-search')?elem.getAttribute('data-search'):'';if(searchText.indexOf(text)!=-1||elem.innerHTML.indexOf(text)!=-1){elem.style.display='';}});});!!ndInputSearch&&ndInputSearch.click(function(e){e.stopPropagation();});}
$.extend(Tablelist.prototype,{'instances':[],'releaseAll':function(){$.each(this['instances'],function(index,val){val.release();});}});